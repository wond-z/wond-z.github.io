(function(page){"use strict";page.options={header_height:825,perf_beacon_prefix:"",scroll_fixed_cutoff:10,story_name:"",root_url:""};var _underline={};var _has_complete_typewrite=false;var _$window=$(window);var _$body=$("body");var _$screenshots=$("#screenshots");var _$ways_container=$("#communicate");var _header_carousel_active=true;var _header_advance_interval=false;var _ways_advance_interval=false;var _HEADER_ADVANCE_PERIOD_MS=5e3;var _WAYS_ADVANCE_PERIOD_MS=5e3;var _$CVO=window.$CVO||[];var _convertro_id=0;var _onDOMReady=function(){_bindUI();_onStart()};var _bindUI=function(){_$window.on("scroll",_onScroll);$("#screenshots .switcher a").on("click",_onClickPagination);$("#screenshots").on("click",_onClickScreenshots);$("#communicate .way").on("click",_onClickTourWay);$("#communicate .switcher a").on("click",_onClickSwitcher);$("#communicate").on("click",_onClickCommunicate);$(".cta_track").on("click",_onClickCTATrack);$(".cta_form").on("submit",_onSubmitCTA)};var _onStart=function(){if(_getQueryVariable("story")||page.options.story_name){_preloadImage();if($(window).width()<641){$(".typed_remove").addClass("hidden");_completeTypewrite()}}_createRotationList()};var _preloadImage=function(){var story_query=_getQueryVariable("story")||page.options.story_name;var header_img;if(story_query=="marsandbeyond"){header_img="nasa-header-image"}else if(story_query=="neutrinoinahaystack"){header_img="neutrino-observatory-header-image"}else if(story_query=="decodingdna"){header_img="macarthur-lab-header-image"}else if(story_query=="brewbetter"){header_img="blue-bottle-header"}else if(story_query=="openforbusiness"){header_img="square-header-image"}else{_typewrite(27);return}var image=new Image;image.onload=function(){setTimeout(_typewrite,2400,27)};image.src="/img/wired/"+header_img+"@tiny.jpg"};var _onLoad=function(){_$CVO.push(["getCode",function(convertro_id){_convertro_id=convertro_id}]);$("nav.mobile_menu").removeClass("loading");$("[data-srcset]").each(function(i){$(this).attr("srcset",$(this).attr("data-srcset"))});$("[data-src]").each(function(i){$(this).attr("src",$(this).attr("data-src"))});$("[data-defer-bg]").each(function(i){$(this).removeAttr("data-defer-bg")});if(_$screenshots.length)_startHeaderAutoAdvance();if(_$ways_container.length)_startWaysAutoAdvance();$("#story_scroll").on("click",function(){var animate_to;if($(".top_ad_header_mobile").length>0&&_$window.width()<=640){animate_to=$(".top_ad_header_mobile")}else if($("header").length>0){animate_to=$("header")}else{animate_to=$("#page")}$("html, body").animate({scrollTop:animate_to.offset().top-$("nav.top").height()},250)});var query_story=_getQueryVariable("story");var query_slide=_getQueryVariable("s");var query_cta_bottom=_getQueryVariable("cta_bottom");if(_getQueryVariable("hp_debug")!=="1"){setTimeout(function(){if(_getQueryVariable("reset_cookie")==="1"){eraseCookie("lp_nt",".slack.com")}else if(_getQueryVariable("story")==="marsandbeyond"){history.replaceState({},"story","/")}else if(_getQueryVariable("story")==="openforbusiness"){history.replaceState({},"story","/")}else if(_getQueryVariable("story")==="neutrinoinahaystack"){history.replaceState({},"story","/")}else if(_getQueryVariable("clean")==="1"){history.replaceState({},"clean","/")}},bowser.msie?200:0)}var hp_version_perf;if(query_story){hp_version_perf="slide_"+(query_slide?query_slide:"0")+"_cta_"+(query_cta_bottom?query_cta_bottom:"0")}else{hp_version_perf="control"}if(page.options.perf_beacon_prefix){window.TSMeasureAndBeacon(page.options.perf_beacon_prefix+"_load","start_load");window.TSMeasureAndBeacon(page.options.perf_beacon_prefix+"_total_load","start_nav");window.TSMeasureAndBeacon(page.options.perf_beacon_prefix+"_"+hp_version_perf+"_load","start_load")}};var _typewrite=function(speed){$(".typed_remove").addClass("hidden");$(".typewriter").typed({strings:[$(".typewriter_copy").html()],typeSpeed:speed,callback:_completeTypewrite})};var _completeTypewrite=function(){if(_has_complete_typewrite)return;_underline.robots_path=bowser.msie?$(".underline_robots_image"):$(".underline_robots_path");_underline.mars_path=bowser.msie?$(".underline_mars_image"):$(".underline_mars_path");_underline.robots=$(".underline_robots");_underline.mars=$(".underline_mars");_underline.robots.append(_underline.robots_path);_underline.mars.append(_underline.mars_path);$(".typed-cursor").addClass("hide");_$body.addClass("start_animation");_has_complete_typewrite=true};var _createRotationList=function(){var list=["neutrinoinahaystack","waterislife","marsandbeyond"];if(readCookie("lp_l")){list=readCookie("lp_l");list=list.split(",");list.push(list.shift())}createCookie("lp_l",list,365,"slack.com")};var _onScroll=function(e){if($("nav.top[data-no-scroll]").length)return;if(this.pageYOffset>=page.options.scroll_fixed_cutoff&&!_$body.hasClass("scrolled")){_$body.addClass("scrolled")}else if(this.pageYOffset<page.options.scroll_fixed_cutoff&&_$body.hasClass("scrolled")){_$body.removeClass("scrolled")}if(this.pageYOffset>=page.options.header_height){_header_carousel_active=false}else{_header_carousel_active=true}};var _onClickPagination=function(e){e.preventDefault();e.stopPropagation();_stopHeaderAutoAdvance();$("#screenshots").attr("data-highlight",$(this).data("highlight"))};var _onClickScreenshots=function(){_stopHeaderAutoAdvance();_moveHeaderCarouselRight()};var _onClickTourWay=function(e){if($(document).width()<=945)return;e.stopPropagation();_stopWaysAutoAdvance();$("#communicate").attr("data-highlight",$(this).data("highlight"))};var _onClickSwitcher=function(e){e.preventDefault();e.stopPropagation();_stopWaysAutoAdvance();$("#communicate").attr("data-highlight",$(this).data("highlight"))};var _onClickCommunicate=function(e){_stopWaysAutoAdvance();_moveWaysForward()};var _onClickCTATrack=function(e){e.preventDefault();$(this).append('<form id="cta_submit" action="'+page.options.root_url+'create" method="post" type="hidden"></form>');$("#cta_submit").submit()};var _onSubmitCTA=function(e){e.preventDefault();var $form=$(this);var $email=$(".input_email",$(this));var email_str=$.trim($email.val()).replace(/[\u200B-\u200D\uFEFF]/g,"");var email_regex=new RegExp("^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$","i");var error_msg,error_color;var d=$.Deferred();d.fail(function(){_addToolTip($form.find(".cta_input_email_wrapper"),error_msg,error_color)});if(!email_str){error_msg=TS.i18n.t("Please fill out your email address!","page_landing")();return d.reject(error_msg)}if(!email_regex.test(email_str)){error_msg=TS.i18n.t("Oops! That looks like an invalid email address!","page_landing")();return d.reject(error_msg)}window.callSlackAPIUnauthed("signup.checkEmail",{email:email_str},function(ok,data,args){if(ok){return d.resolve()}if(data.error==="bad_email_domain"){var email_domain=email_str.split("@")[1];error_msg=TS.i18n.t('Sorry, but we do not allow signups from @{email_domain}.<br class="hide_on_mobile"> Please pick a different email address!',"page_landing")({email_domain:email_domain});error_color="red"}else{error_msg=TS.i18n.t('Sorry, you’ve hit the rate limit.<br class="hide_on_mobile"> You’ll be able to try again soon.',"page_landing")();error_color="red"}return d.reject()});d.then(function(){$form.off("submit");$form.submit()})};var _addToolTip=function($input_wrapper,error_msg,error_color){error_color=error_color||"orange";var $ts_tip_tip=$input_wrapper.find(".ts_tip_tip");var $input_email=$input_wrapper.find(".input_email");if(!$ts_tip_tip.length){$ts_tip_tip=$('<span class="ts_tip_tip"><span class="ts_tip_multiline_inner">'+error_msg+"</span></span>");$input_wrapper.addClass("ts_tip ts_tip_top ts_tip_float ts_tip_hide ts_tip_multiline").append($ts_tip_tip);$input_email.on("input",function(){$input_wrapper.addClass("ts_tip_hide")});setTimeout(function(){$input_wrapper.removeClass("ts_tip_hide")},0)}else{$input_wrapper.removeClass("ts_tip_hide").find(".ts_tip_multiline_inner").html(error_msg)}$ts_tip_tip.attr("data-color",error_color);$input_email.focus()};var _moveHeaderCarouselRight=function(){if(!_header_carousel_active)return;var current=_$screenshots.attr("data-highlight");switch(current){case"channels":_$screenshots.attr("data-highlight","integrations");break;case"integrations":_$screenshots.attr("data-highlight","search");break;case"search":_$screenshots.attr("data-highlight","channels");break}};var _startHeaderAutoAdvance=function(){if(!_header_advance_interval){_header_advance_interval=setInterval(_moveHeaderCarouselRight,_HEADER_ADVANCE_PERIOD_MS)}};var _stopHeaderAutoAdvance=function(){clearInterval(_header_advance_interval);_header_advance_interval=false};var _moveWaysForward=function(){if(!_header_carousel_active)return;var current=_$ways_container.attr("data-highlight");switch(current){case"channel":_$ways_container.attr("data-highlight","group");break;case"dm":_$ways_container.attr("data-highlight","channel");break;case"group":_$ways_container.attr("data-highlight","dm");break}};var _startWaysAutoAdvance=function(){if(!_ways_advance_interval){_ways_advance_interval=setInterval(_moveWaysForward,_WAYS_ADVANCE_PERIOD_MS)}};var _stopWaysAutoAdvance=function(){clearInterval(_ways_advance_interval);_ways_advance_interval=false};var _getQueryVariable=function(variable){var query=window.location.search.substring(1);var vars=query.split("&");for(var i=0;i<vars.length;i++){var pair=vars[i].split("=");if(pair[0]==variable)return pair[1]}return false};$(document).ready(_onDOMReady);$(window).load(_onLoad)})(window.page_landing=window.page_landing||{});
